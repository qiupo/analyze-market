name: Build Cross-Platform Packages

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: [3.9]

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install system dependencies (Linux)
      if: matrix.os == 'ubuntu-latest'
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential python3-dev wget pkg-config
        
        # å®‰è£… TA-Lib ç³»ç»Ÿä¾èµ–
        cd /tmp
        wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
        tar -xzf ta-lib-0.4.0-src.tar.gz
        cd ta-lib/
        ./configure --prefix=/usr/local
        make
        sudo make install
        
        # æ›´æ–°åŠ¨æ€é“¾æ¥åº“å’Œpkg-config
        sudo ldconfig
        echo 'export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH' >> $GITHUB_ENV
        echo 'export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH' >> $GITHUB_ENV
        
        # éªŒè¯å®‰è£…
        ls -la /usr/local/lib/libta-lib*
        pkg-config --libs ta-lib || echo "pkg-config not found for ta-lib"
    
    - name: Install system dependencies (macOS)
      if: matrix.os == 'macos-latest'
      run: |
        brew install ta-lib
    
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install numpy pandas streamlit plotly akshare
        # å®‰è£… TA-Lib æ—¶è®¾ç½®æ­£ç¡®çš„åº“è·¯å¾„
        if [ "$RUNNER_OS" = "Linux" ]; then
          export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
          export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH
          echo "LD_LIBRARY_PATH: $LD_LIBRARY_PATH"
          echo "PKG_CONFIG_PATH: $PKG_CONFIG_PATH"
          echo "Checking for ta-lib library:"
          ls -la /usr/local/lib/libta-lib* || echo "Library not found in /usr/local/lib"
          pkg-config --libs ta-lib || echo "pkg-config ta-lib failed"
        fi
        pip install TA-Lib
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Create main entry file
      run: |
        echo '#!/usr/bin/env python3' > main.py
        echo '"""' >> main.py
        echo 'BandMaster Pro ä¸»å…¥å£æ–‡ä»¶' >> main.py
        echo '"""' >> main.py
        echo '' >> main.py
        echo 'import os' >> main.py
        echo 'import sys' >> main.py
        echo 'import subprocess' >> main.py
        echo 'import webbrowser' >> main.py
        echo 'import time' >> main.py
        echo 'import socket' >> main.py
        echo 'from pathlib import Path' >> main.py
        echo '' >> main.py
        echo 'def find_available_port(start_port=8501, max_port=8600):' >> main.py
        echo '    """æŸ¥æ‰¾å¯ç”¨ç«¯å£"""' >> main.py
        echo '    for port in range(start_port, max_port):' >> main.py
        echo '        try:' >> main.py
        echo '            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:' >> main.py
        echo '                s.bind(("localhost", port))' >> main.py
        echo '                return port' >> main.py
        echo '        except OSError:' >> main.py
        echo '            continue' >> main.py
        echo '    return start_port' >> main.py
        echo '' >> main.py
        echo 'def main():' >> main.py
        echo '    """ä¸»å‡½æ•°"""' >> main.py
        echo '    print("=" * 60)' >> main.py
        echo '    print("ğŸš€ BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹")' >> main.py
        echo '    print("=" * 60)' >> main.py
        echo '    port = find_available_port()' >> main.py
        echo '    print(f"ğŸ“¡ å¯åŠ¨æœåŠ¡...")' >> main.py
        echo '    print(f"ğŸŒ è®¿é—®åœ°å€: http://localhost:{port}")' >> main.py
        echo '    print("=" * 60)' >> main.py
        echo '    if getattr(sys, "frozen", False):' >> main.py
        echo '        base_path = sys._MEIPASS' >> main.py
        echo '        app_path = os.path.join(base_path, "src", "app.py")' >> main.py
        echo '    else:' >> main.py
        echo '        app_path = os.path.join("src", "app.py")' >> main.py
        echo '    try:' >> main.py
        echo '        cmd = [sys.executable, "-m", "streamlit", "run", app_path,' >> main.py
        echo '               "--server.port", str(port),' >> main.py
        echo '               "--server.headless", "true",' >> main.py
        echo '               "--browser.gatherUsageStats", "false"]' >> main.py
        echo '        print("â³ æ­£åœ¨å¯åŠ¨åº”ç”¨...")' >> main.py
        echo '        process = subprocess.Popen(cmd)' >> main.py
        echo '        time.sleep(3)' >> main.py
        echo '        webbrowser.open(f"http://localhost:{port}")' >> main.py
        echo '        print("âœ… åº”ç”¨å·²å¯åŠ¨")' >> main.py
        echo '        print("æŒ‰ Ctrl+C åœæ­¢åº”ç”¨")' >> main.py
        echo '        process.wait()' >> main.py
        echo '    except KeyboardInterrupt:' >> main.py
        echo '        print("ğŸ›‘ æ­£åœ¨åœæ­¢åº”ç”¨...")' >> main.py
        echo '        process.terminate()' >> main.py
        echo '        try:' >> main.py
        echo '            process.wait(timeout=5)' >> main.py
        echo '        except subprocess.TimeoutExpired:' >> main.py
        echo '            process.kill()' >> main.py
        echo '        print("âœ… åº”ç”¨å·²åœæ­¢")' >> main.py
        echo '    except SystemExit:' >> main.py
        echo '        print("ğŸ›‘ åº”ç”¨é€€å‡º...")' >> main.py
        echo '        process.terminate()' >> main.py
        echo '        try:' >> main.py
        echo '            process.wait(timeout=5)' >> main.py
        echo '        except subprocess.TimeoutExpired:' >> main.py
        echo '            process.kill()' >> main.py
        echo '    except Exception as e:' >> main.py
        echo '        print(f"âŒ å¯åŠ¨å¤±è´¥: {e}")' >> main.py
        echo '        print("æŒ‰å›è½¦é”®é€€å‡º...")' >> main.py
        echo '        try:' >> main.py
        echo '            input()' >> main.py
        echo '        except:' >> main.py
        echo '            pass' >> main.py
        echo '' >> main.py
        echo 'if __name__ == "__main__":' >> main.py
        echo '    main()' >> main.py
    
    - name: Build with PyInstaller (Windows)
      if: matrix.os == 'windows-latest'
      shell: cmd
      run: pyinstaller --onefile --console --name=BandMasterPro --distpath=dist --workpath=build --specpath=. --clean --add-data=src;src --hidden-import=streamlit --hidden-import=akshare --hidden-import=pandas --hidden-import=numpy --hidden-import=plotly --hidden-import=talib main.py
    
    - name: Build with PyInstaller (Linux/macOS)
      if: matrix.os != 'windows-latest'
      run: pyinstaller --onefile --console --name=BandMasterPro --distpath=dist --workpath=build --specpath=. --clean --add-data=src:src --hidden-import=streamlit --hidden-import=akshare --hidden-import=pandas --hidden-import=numpy --hidden-import=plotly --hidden-import=talib main.py
    
    - name: Create Windows launcher script
      if: matrix.os == 'windows-latest'
      shell: cmd
      run: |
        if not exist dist mkdir dist
        echo @echo off > dist\å¯åŠ¨åº”ç”¨.bat
        echo title BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹ >> dist\å¯åŠ¨åº”ç”¨.bat
        echo . >> dist\å¯åŠ¨åº”ç”¨.bat
        echo echo ======================================== >> dist\å¯åŠ¨åº”ç”¨.bat
        echo echo   BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹ >> dist\å¯åŠ¨åº”ç”¨.bat
        echo echo ======================================== >> dist\å¯åŠ¨åº”ç”¨.bat
        echo . >> dist\å¯åŠ¨åº”ç”¨.bat
        echo echo æ­£åœ¨å¯åŠ¨åº”ç”¨... >> dist\å¯åŠ¨åº”ç”¨.bat
        echo . >> dist\å¯åŠ¨åº”ç”¨.bat
        echo if exist "BandMasterPro.exe" ( >> dist\å¯åŠ¨åº”ç”¨.bat
        echo     BandMasterPro.exe >> dist\å¯åŠ¨åº”ç”¨.bat
        echo ) else ( >> dist\å¯åŠ¨åº”ç”¨.bat
        echo     echo é”™è¯¯: æ‰¾ä¸åˆ° BandMasterPro.exe >> dist\å¯åŠ¨åº”ç”¨.bat
        echo     echo è¯·ç¡®ä¿æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ >> dist\å¯åŠ¨åº”ç”¨.bat
        echo     pause >> dist\å¯åŠ¨åº”ç”¨.bat
        echo ) >> dist\å¯åŠ¨åº”ç”¨.bat
    
    - name: Create Linux/macOS launcher script
      if: matrix.os != 'windows-latest'
      run: |
        mkdir -p dist
        echo '#!/bin/bash' > dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo "========================================"' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo "  BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹"' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo "========================================"' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo "æ­£åœ¨å¯åŠ¨åº”ç”¨..."' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'echo' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'if [ -f "./BandMasterPro" ]; then' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo '    chmod +x ./BandMasterPro' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo '    ./BandMasterPro' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'else' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo '    echo "é”™è¯¯: æ‰¾ä¸åˆ° BandMasterPro"' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo '    echo "è¯·ç¡®ä¿æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹"' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo '    read -p "æŒ‰å›è½¦é”®é€€å‡º..."' >> dist/å¯åŠ¨åº”ç”¨.sh
        echo 'fi' >> dist/å¯åŠ¨åº”ç”¨.sh
        chmod +x dist/å¯åŠ¨åº”ç”¨.sh
    
    - name: Create Windows README
      if: matrix.os == 'windows-latest'
      shell: cmd
      run: |
        echo # BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹ (Windowsç‰ˆæœ¬) > dist\README.md
        echo. >> dist\README.md
        echo ## ğŸ“¦ æ‰“åŒ…ç‰ˆæœ¬è¯´æ˜ >> dist\README.md
        echo. >> dist\README.md
        echo è¿™æ˜¯ BandMaster Pro çš„ç‹¬ç«‹æ‰“åŒ…ç‰ˆæœ¬ï¼Œæ— éœ€å®‰è£… Python ç¯å¢ƒå³å¯ç›´æ¥è¿è¡Œã€‚ >> dist\README.md
        echo. >> dist\README.md
        echo ## ğŸš€ å¿«é€Ÿå¯åŠ¨ >> dist\README.md
        echo. >> dist\README.md
        echo ### Windows ç³»ç»Ÿ >> dist\README.md
        echo 1. åŒå‡» `å¯åŠ¨åº”ç”¨.bat` æˆ–ç›´æ¥è¿è¡Œ `BandMasterPro.exe` >> dist\README.md
        echo 2. ç­‰å¾…åº”ç”¨å¯åŠ¨ï¼ˆé¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦10-30ç§’ï¼‰ >> dist\README.md
        echo 3. æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€åº”ç”¨ç•Œé¢ >> dist\README.md
        echo. >> dist\README.md
        echo ## ğŸ“Š åŠŸèƒ½ç‰¹è‰² >> dist\README.md
        echo. >> dist\README.md
        echo - **æ™ºèƒ½æ³¢æ®µè¯†åˆ«**: å¤šå‘¨æœŸååŒåˆ†æ >> dist\README.md
        echo - **å…­ç»´ä¿¡å·éªŒè¯**: è¶‹åŠ¿ã€åŠ¨é‡ã€é‡èƒ½ã€èµ„é‡‘ã€å½¢æ€ã€ç¯å¢ƒ >> dist\README.md
        echo - **ç²¾å‡†ä¹°å–ç‚¹**: åŸºäºé‡åŒ–æ¨¡å‹çš„å†³ç­–çŸ©é˜µ >> dist\README.md
        echo - **åŠ¨æ€ä»“ä½ç®¡ç†**: åº•ä»“+åŠ ä»“+è¡¥ä»“+T+0ç­–ç•¥ >> dist\README.md
        echo - **å®Œæ•´é£æ§ä½“ç³»**: æ­¢ç›ˆã€æ­¢æŸã€æ—¶é—´ã€ç´§æ€¥å››é‡ä¿æŠ¤ >> dist\README.md
        echo. >> dist\README.md
        echo ## ğŸ”§ ä½¿ç”¨è¯´æ˜ >> dist\README.md
        echo. >> dist\README.md
        echo 1. åœ¨å·¦ä¾§è¾“å…¥6ä½è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰ >> dist\README.md
        echo 2. é€‰æ‹©åˆ†æå‘¨æœŸ >> dist\README.md
        echo 3. å¯é€‰æ‹©è®¾ç½®æŒä»“ä¿¡æ¯è¿›è¡Œä¸ªæ€§åŒ–åˆ†æ >> dist\README.md
        echo 4. ç‚¹å‡»"å¼€å§‹åˆ†æ"æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š >> dist\README.md
        echo. >> dist\README.md
        echo ## âš ï¸ æ³¨æ„äº‹é¡¹ >> dist\README.md
        echo. >> dist\README.md
        echo 1. **é¦–æ¬¡å¯åŠ¨**: å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾… >> dist\README.md
        echo 2. **ç½‘ç»œè¿æ¥**: éœ€è¦ç½‘ç»œè¿æ¥è·å–è‚¡ç¥¨æ•°æ® >> dist\README.md
        echo 3. **é˜²ç«å¢™**: éƒ¨åˆ†é˜²ç«å¢™å¯èƒ½é˜»æ­¢åº”ç”¨å¯åŠ¨ï¼Œè¯·æ·»åŠ ä¿¡ä»» >> dist\README.md
        echo 4. **ç«¯å£å ç”¨**: å¦‚æœ8501ç«¯å£è¢«å ç”¨ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨å¯»æ‰¾å…¶ä»–å¯ç”¨ç«¯å£ >> dist\README.md
        echo. >> dist\README.md
        echo ## ğŸ› ï¸ æ•…éšœæ’é™¤ >> dist\README.md
        echo. >> dist\README.md
        echo ### å¯åŠ¨å¤±è´¥ >> dist\README.md
        echo - æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘100MBï¼‰ >> dist\README.md
        echo - å°è¯•ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ >> dist\README.md
        echo - ä¸´æ—¶å…³é—­æ€æ¯’è½¯ä»¶ >> dist\README.md
        echo. >> dist\README.md
        echo ### æµè§ˆå™¨æœªæ‰“å¼€ >> dist\README.md
        echo - æ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æ§åˆ¶å°æ˜¾ç¤ºçš„åœ°å€ >> dist\README.md
        echo - é€šå¸¸ä¸º: http://localhost:8501 >> dist\README.md
        echo. >> dist\README.md
        echo ### æ•°æ®è·å–å¤±è´¥ >> dist\README.md
        echo - æ£€æŸ¥ç½‘ç»œè¿æ¥ >> dist\README.md
        echo - ç¡®è®¤è‚¡ç¥¨ä»£ç æ ¼å¼æ­£ç¡®ï¼ˆ6ä½æ•°å­—ï¼‰ >> dist\README.md
        echo. >> dist\README.md
        echo ## ğŸ“ æŠ€æœ¯æ”¯æŒ >> dist\README.md
        echo. >> dist\README.md
        echo å¦‚é‡é—®é¢˜è¯·æ£€æŸ¥ï¼š >> dist\README.md
        echo 1. ç³»ç»Ÿå…¼å®¹æ€§ >> dist\README.md
        echo 2. ç½‘ç»œè¿æ¥çŠ¶æ€ >> dist\README.md
        echo 3. é˜²ç«å¢™è®¾ç½® >> dist\README.md
        echo 4. ç£ç›˜ç©ºé—´ >> dist\README.md
        echo. >> dist\README.md
        echo --- >> dist\README.md
        echo. >> dist\README.md
        echo **å…è´£å£°æ˜**: æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…ã€‚ >> dist\README.md
    
    - name: Create Linux/macOS README
      if: matrix.os != 'windows-latest'
      run: |
        if [ "$RUNNER_OS" = "macOS" ]; then
          PLATFORM="macOS"
        else
          PLATFORM="Linux"
        fi
        echo "# BandMaster Pro - æ™ºç­–æ³¢æ®µäº¤æ˜“åŠ©æ‰‹ ($PLATFORMç‰ˆæœ¬)" > dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸ“¦ æ‰“åŒ…ç‰ˆæœ¬è¯´æ˜" >> dist/README.md
        echo "" >> dist/README.md
        echo "è¿™æ˜¯ BandMaster Pro çš„ç‹¬ç«‹æ‰“åŒ…ç‰ˆæœ¬ï¼Œæ— éœ€å®‰è£… Python ç¯å¢ƒå³å¯ç›´æ¥è¿è¡Œã€‚" >> dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸš€ å¿«é€Ÿå¯åŠ¨" >> dist/README.md
        echo "" >> dist/README.md
        echo "### $PLATFORM ç³»ç»Ÿ" >> dist/README.md
        echo "1. åŒå‡» \`./å¯åŠ¨åº”ç”¨.sh\` æˆ–ç›´æ¥è¿è¡Œ \`BandMasterPro\`" >> dist/README.md
        echo "2. ç­‰å¾…åº”ç”¨å¯åŠ¨ï¼ˆé¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦10-30ç§’ï¼‰" >> dist/README.md
        echo "3. æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€åº”ç”¨ç•Œé¢" >> dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸ“Š åŠŸèƒ½ç‰¹è‰²" >> dist/README.md
        echo "" >> dist/README.md
        echo "- **æ™ºèƒ½æ³¢æ®µè¯†åˆ«**: å¤šå‘¨æœŸååŒåˆ†æ" >> dist/README.md
        echo "- **å…­ç»´ä¿¡å·éªŒè¯**: è¶‹åŠ¿ã€åŠ¨é‡ã€é‡èƒ½ã€èµ„é‡‘ã€å½¢æ€ã€ç¯å¢ƒ" >> dist/README.md
        echo "- **ç²¾å‡†ä¹°å–ç‚¹**: åŸºäºé‡åŒ–æ¨¡å‹çš„å†³ç­–çŸ©é˜µ" >> dist/README.md
        echo "- **åŠ¨æ€ä»“ä½ç®¡ç†**: åº•ä»“+åŠ ä»“+è¡¥ä»“+T+0ç­–ç•¥" >> dist/README.md
        echo "- **å®Œæ•´é£æ§ä½“ç³»**: æ­¢ç›ˆã€æ­¢æŸã€æ—¶é—´ã€ç´§æ€¥å››é‡ä¿æŠ¤" >> dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸ”§ ä½¿ç”¨è¯´æ˜" >> dist/README.md
        echo "" >> dist/README.md
        echo "1. åœ¨å·¦ä¾§è¾“å…¥6ä½è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰" >> dist/README.md
        echo "2. é€‰æ‹©åˆ†æå‘¨æœŸ" >> dist/README.md
        echo "3. å¯é€‰æ‹©è®¾ç½®æŒä»“ä¿¡æ¯è¿›è¡Œä¸ªæ€§åŒ–åˆ†æ" >> dist/README.md
        echo "4. ç‚¹å‡»"å¼€å§‹åˆ†æ"æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š" >> dist/README.md
        echo "" >> dist/README.md
        echo "## âš ï¸ æ³¨æ„äº‹é¡¹" >> dist/README.md
        echo "" >> dist/README.md
        echo "1. **é¦–æ¬¡å¯åŠ¨**: å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…" >> dist/README.md
        echo "2. **ç½‘ç»œè¿æ¥**: éœ€è¦ç½‘ç»œè¿æ¥è·å–è‚¡ç¥¨æ•°æ®" >> dist/README.md
        echo "3. **é˜²ç«å¢™**: éƒ¨åˆ†é˜²ç«å¢™å¯èƒ½é˜»æ­¢åº”ç”¨å¯åŠ¨ï¼Œè¯·æ·»åŠ ä¿¡ä»»" >> dist/README.md
        echo "4. **ç«¯å£å ç”¨**: å¦‚æœ8501ç«¯å£è¢«å ç”¨ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨å¯»æ‰¾å…¶ä»–å¯ç”¨ç«¯å£" >> dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸ› ï¸ æ•…éšœæ’é™¤" >> dist/README.md
        echo "" >> dist/README.md
        echo "### å¯åŠ¨å¤±è´¥" >> dist/README.md
        echo "- æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘100MBï¼‰" >> dist/README.md
        echo "- å°è¯•ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ" >> dist/README.md
        echo "- ä¸´æ—¶å…³é—­æ€æ¯’è½¯ä»¶" >> dist/README.md
        echo "" >> dist/README.md
        echo "### æµè§ˆå™¨æœªæ‰“å¼€" >> dist/README.md
        echo "- æ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æ§åˆ¶å°æ˜¾ç¤ºçš„åœ°å€" >> dist/README.md
        echo "- é€šå¸¸ä¸º: http://localhost:8501" >> dist/README.md
        echo "" >> dist/README.md
        echo "### æ•°æ®è·å–å¤±è´¥" >> dist/README.md
        echo "- æ£€æŸ¥ç½‘ç»œè¿æ¥" >> dist/README.md
        echo "- ç¡®è®¤è‚¡ç¥¨ä»£ç æ ¼å¼æ­£ç¡®ï¼ˆ6ä½æ•°å­—ï¼‰" >> dist/README.md
        echo "" >> dist/README.md
        echo "## ğŸ“ æŠ€æœ¯æ”¯æŒ" >> dist/README.md
        echo "" >> dist/README.md
        echo "å¦‚é‡é—®é¢˜è¯·æ£€æŸ¥ï¼š" >> dist/README.md
        echo "1. ç³»ç»Ÿå…¼å®¹æ€§" >> dist/README.md
        echo "2. ç½‘ç»œè¿æ¥çŠ¶æ€" >> dist/README.md
        echo "3. é˜²ç«å¢™è®¾ç½®" >> dist/README.md
        echo "4. ç£ç›˜ç©ºé—´" >> dist/README.md
        echo "" >> dist/README.md
        echo "---" >> dist/README.md
        echo "" >> dist/README.md
        echo "**å…è´£å£°æ˜**: æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…ã€‚" >> dist/README.md
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: BandMasterPro-${{ matrix.os }}
        path: dist/
        retention-days: 30

  release:
    needs: build
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
    
    steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts
    
    - name: Create release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          artifacts/BandMasterPro-ubuntu-latest/*
          artifacts/BandMasterPro-windows-latest/*
          artifacts/BandMasterPro-macos-latest/*
        tag_name: v${{ github.run_number }}
        name: Release v${{ github.run_number }}
        body: |
          ## ğŸ‰ BandMaster Pro è·¨å¹³å°å‘å¸ƒ
          
          æœ¬æ¬¡å‘å¸ƒåŒ…å«ä»¥ä¸‹å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š
          
          - **Windows**: BandMasterPro.exe + å¯åŠ¨åº”ç”¨.bat
          - **Linux**: BandMasterPro + å¯åŠ¨åº”ç”¨.sh  
          - **macOS**: BandMasterPro + å¯åŠ¨åº”ç”¨.sh
          
          ### ğŸ“¦ ä½¿ç”¨è¯´æ˜
          
          1. ä¸‹è½½å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…
          2. è§£å‹åˆ°ä»»æ„ç›®å½•
          3. è¿è¡Œå¯åŠ¨è„šæœ¬æˆ–ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶
          4. ç­‰å¾…åº”ç”¨å¯åŠ¨ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€
          
          ### ğŸ”§ ç³»ç»Ÿè¦æ±‚
          
          - Windows 10/11 (x64)
          - Ubuntu 18.04+ / CentOS 7+
          - macOS 10.14+ (Intel/Apple Silicon)
          
          ### âš ï¸ æ³¨æ„äº‹é¡¹
          
          - é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦10-30ç§’
          - éœ€è¦ç½‘ç»œè¿æ¥è·å–è‚¡ç¥¨æ•°æ®
          - å»ºè®®å…³é—­æ€æ¯’è½¯ä»¶æˆ–æ·»åŠ ä¿¡ä»»
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 